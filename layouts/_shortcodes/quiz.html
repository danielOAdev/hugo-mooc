{{- $pergunta := .Get "pergunta" | safeHTML }}

{{- $opcoes := slice -}}
{{- $multi := .Get "multi" | default true -}}
{{- $corretos := split (.Get "corretos") "," -}}
{{- if not $multi -}}
  {{- $corretos = slice (index $corretos 0) -}}
{{- end -}}
{{- $forma := (cond $multi "square" "circle") -}}

{{- range seq 0 99 -}}
  {{- $indexStr := printf "%d" . -}}
  {{- $key := printf "opcao%d" . -}}
  {{- if $.IsNamedParams -}}
    {{- $texto := $.Get $key -}}
    {{- if $texto -}}
      {{- $eCorreto := in $corretos $indexStr -}}
      {{- $opcao := dict "index" $indexStr "texto" ($texto | safeHTML) "correto" $eCorreto -}}
      {{- $opcoes = $opcoes | append $opcao -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $feedbackpositivo := default "[Feedback positivo]" (.Get "feedbackpositivo" | safeHTML) }}
{{- $feedbacknegativo := default "[Feedback negativo]" (.Get "feedbacknegativo" | safeHTML) }}

<fieldset class="vigi-quiz vstack gap-1" {{ if $multi }}data-multi{{ end }}>
    <legend>{{ $pergunta }}</legend>
    {{ range $opcoes }}
        <label class="opcao btn btn-secondary {{- cond .correto " correto" "" -}}">
            {{ partial "fontawesome.html" (dict "style" "regular" "icon" $forma "classes" (print "icone-lg " $forma)) }}
            {{ partial "fontawesome.html" (dict "style" "regular" "icon" (print $forma "-check") "classes" (print $forma "-check icone-lg")) }}
            <input type="{{ cond $multi "checkbox" "radio"}}" name="opcao{{ .index }}">
            <div>{{ .texto }}</div>
        </label>
    {{ end }}
    <button type="button" class="confirmar btn btn-primary">Confirmar</button>
    <div class="acoesfinais gap-1 flex-wrap">
        <button type="button" class="tentar btn btn-primary flex-grow-1">Tentar novamente</button>
        <button type="button" class="correcao btn btn-secondary flex-grow-1">Mostrar resposta</button>
    </div>
    <div class="feedback feedback-positivo alert alert-success">{{ $feedbackpositivo }}</div>
    <div class="feedback feedback-negativo alert alert-danger">{{ $feedbacknegativo }}</div>
</fieldset>